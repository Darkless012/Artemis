<?xml version="1.0" encoding="UTF-8" ?> 
 
<!DOCTYPE sqlMap 
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
    "http://ibatis.apache.org/dtd/sql-map-2.dtd"> 
 

<sqlMap namespace="Alias"> 

    <select id="getAlias" resultClass="uk.ac.sanger.artemis.chado.Alias"
            parameterClass="uk.ac.sanger.artemis.chado.Alias">
      SELECT s.name, f.feature_id, cvterm.name AS cvterm_name 
      FROM $schema$.feature_synonym fs 
      LEFT JOIN $schema$.feature f ON f.feature_id=fs.feature_id 
      LEFT JOIN $schema$.synonym s ON fs.synonym_id=s.synonym_id 
      LEFT JOIN cvterm ON s.type_id=cvterm_id
      <isNotNull property="uniquename">                        
          WHERE uniquename=#uniquename#
      </isNotNull>
    </select>
    
    <select id="getSynonymId" resultClass="java.lang.Integer"
            parameterClass="uk.ac.sanger.artemis.chado.Alias">
      SELECT synonym_id FROM $schema$.synonym WHERE synonym.name=#name#
    </select>
   
    <select id="getFeatureSynonymId" resultClass="java.lang.Integer"
            parameterClass="uk.ac.sanger.artemis.chado.Alias">
      SELECT synonym_id FROM $schema$.feature_synonym WHERE
             synonym_id=(SELECT synonym_id FROM $schema$.synonym WHERE 
             synonym.name=#name#)
    </select>
   
  <!-- WRITE BACK -->
    <delete id="deleteFeatureAlias" parameterClass="uk.ac.sanger.artemis.chado.Alias">
      DELETE FROM $schema$.feature_synonym WHERE
         synonym_id=$synonym_id$ AND 
         feature_id=(SELECT feature_id FROM $schema$.feature WHERE  
         uniquename=#uniquename#)
    </delete>
  
    <insert id="insertFeatureAlias">
      INSERT INTO $schema$.feature_synonym ( synonym_id, feature_id, pub_id )
      VALUES ( $synonym_id$ , 
              (SELECT feature_id FROM $schema$.feature WHERE uniquename=#uniquename#), 
              1)
    </insert>
  
    <delete id="deleteAlias" parameterClass="uk.ac.sanger.artemis.chado.Alias">
      DELETE FROM $schema$.synonym WHERE synonym_id=$synonym_id$
    </delete>
  
    <insert id="insertAlias" parameterClass="uk.ac.sanger.artemis.chado.Alias">
      INSERT INTO $schema$.synonym ( name, type_id, synonym_sgml ) 
      VALUES ( #name#, $type_id$, #name# )
    </insert>
  
</sqlMap> 