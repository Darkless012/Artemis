<?xml version="1.0" encoding="UTF-8" ?> 
 
<!DOCTYPE sqlMap 
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
    "http://ibatis.apache.org/dtd/sql-map-2.dtd"> 
 
<sqlMap namespace="Organism"> 
      
    <cacheModel id="organism-cache" type ="LRU" readOnly="true"> 
      <flushInterval hours="24"/>  
      <property name="cache-size" value="100" /> 
    </cacheModel> 

    <select id="getOrganism"
     resultClass="org.gmod.schema.organism.Organism"> 
      SELECT organism_id AS organismId, abbreviation, genus, species, common_name AS commonName, comment 
      FROM organism
      <dynamic>
        <isNotNull prepend="WHERE" property="organismId">
           organism_id=#organismId#
        </isNotNull>
        
        <isNull prepend="ORDER BY" property="organismId">
           commonName
        </isNull>
      </dynamic>
    </select> 
    
    
    <select id="getOrganismID" resultClass="java.lang.Integer" 
            parameterClass="org.gmod.schema.sequence.Feature" cacheModel="organism-cache">
      SELECT organism_id AS organismId FROM feature f WHERE
        <isGreaterThan property="featureLoc.featureBySrcFeatureId.featureId" compareValue="0"> 
             f.feature_id=$featureLoc.featureBySrcFeatureId.featureId$
        </isGreaterThan>
		<isEqual property="featureLoc.featureBySrcFeatureId.featureId" compareValue="0">
			<isGreaterThan property="featureId" compareValue="0"> 
				f.feature_id=$featureId$
			</isGreaterThan>
		</isEqual>
    </select>
 
</sqlMap> 
